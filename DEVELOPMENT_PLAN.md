# local-doc-search 開発プラン

## 目的
- ローカルにある資料（主にPDF / Word）を取り込み、キーワード検索で「該当箇所（ページ/段落）」を素早く見つける
- チャット風UIで結果を見やすく表示し、引用・調査メモを作りやすくする
- 外部API/LLMなしで完結（オフライン前提）

---

## マイルストーン
- M0: リポジトリ初期化（完了）
- M1: UI骨組み（検索画面・文書管理画面）
- M2: ローカルDB（SQLite）導入＆全文検索（FTS）
- M3: 取り込み（PDF/Word）→ インデックス作成
- M4: 検索結果（スニペット/ハイライト/文書束ね）
- M5: PDFビューア（ページジャンプ）
- M6: 引用コピー/メモ支援
- M7: 配布を見据えた調整（Tauri化の下準備）

---

## M1: UI骨組み
- [ ] ルーティング作成
  - [ ] `/` 検索画面（チャット風ログ + 検索入力）
  - [ ] `/documents` 文書管理（一覧/削除/タグ）
- [ ] レイアウト（最低限）
  - [ ] 左：検索結果（チャットログ）
  - [ ] 右：プレビュー領域（将来PDFビューア）
- [ ] ダミーデータで見た目だけ作る
  - [ ] ResultCard（文書名/ページ/抜粋/ボタン）
  - [ ] ChatLog（検索→結果を時系列表示）

---

## M2: SQLite導入 & 全文検索（FTS）
- [ ] DB方式決定（推奨：SQLite + FTS5）
- [ ] DB初期化処理
  - [ ] `documents` テーブル
  - [ ] `chunks`（ページ/段落）テーブル
  - [ ] `chunks_fts`（FTS）テーブル or FTS仮想テーブル
- [ ] API（Next Route）雛形
  - [ ] `POST /api/search`（クエリ受け取り→FTS検索→結果返却）
  - [ ] `GET /api/documents`（一覧）
- [ ] 検索オプション（最低限）
  - [ ] AND/OR切替（UI）
  - [ ] 複数語の扱い（スペース区切り）
  - [ ] 文書フィルタ（タグ/種別は後回しでもOK）

---

## M3: 取り込み（PDF / Word）
### 共通
- [ ] 取り込みフロー作成
  - [ ] ファイル選択 or D&D
  - [ ] 文書メタ登録（title, path, created_at）
  - [ ] テキスト抽出 → chunk化 → DBに保存
- [ ] 取り込み失敗時の表示（重要）
  - [ ] 「テキスト抽出できない可能性（画像PDF等）」を出す
  - [ ] 文書にステータス付与（`has_text=false` 等）

### PDF
- [ ] PDFテキスト抽出（ページ単位）
  - [ ] page_no / page_text を保存
- [ ] 文字化け/改行崩れの最低限整形
  - [ ] 連続空白を縮める
  - [ ] 行末ハイフン結合（可能なら）

### Word（.docx）
- [ ] docxテキスト抽出（段落 or 見出し＋段落）
- [ ] 見出し情報が取れるなら `heading` として保存（任意）

---

## M4: 検索結果のUX改善（LLMなしでも“賢そう”に見えるところ）
- [ ] スニペット生成
  - [ ] ヒット位置周辺を N文字切り出し
- [ ] 検索語ハイライト（UI）
- [ ] 結果の束ね（文書→ページ/段落）
  - [ ] 同一文書は折りたたみ表示
- [ ] ランキング改善（軽め）
  - [ ] ヒット回数
  - [ ] 近接（同一chunk内に複数語が近いほど上位）
  - [ ] 新しい文書を少し優遇（任意）

---

## M5: PDFビューア & ページジャンプ
- [ ] アプリ内PDF表示（右ペイン or モーダル）
- [ ] 検索結果から該当ページへジャンプ
- [ ] ページ内ハイライト（できれば）
  - [ ] 無理ならページジャンプのみでMVP達成

---

## M6: 引用・調査メモ支援
- [ ] 結果カードに「引用としてコピー」
  - [ ] 形式例：`[文書名 p.12] 抜粋...`
- [ ] 複数選択してまとめてコピー
- [ ] 検索履歴（任意）
  - [ ] “さっき何調べたっけ”防止

---

## M7: 配布（Tauri化）を見据えた下準備
- [ ] ファイル保存場所の設計（ローカル）
  - [ ] アプリ用データディレクトリへコピーするか、パス参照にするか決める
- [ ] OS依存パスの扱い（Windows想定）
- [ ] エラーメッセージの整備（非エンジニア向け）
- [ ] （将来）Tauri移行メモ作成
  - [ ] `next build` の成果物をWebViewで表示する方針

---

## “後回し”リスト（拡張アイデア）
- [ ] OCR（画像PDF対応）
- [ ] 表記揺れ/略語辞書（検索語の自動拡張）
- [ ] Word/Excel/PPTの追加対応（優先はdocx）
- [ ] ベクトル検索（意味検索）※LLMなしでも可能
- [ ] ローカルLLM連携（Ollama等）※オプション

---

## コミットの目安
- `docs: add DEVELOPMENT_PLAN`
- `feat: add pages (search/documents)`
- `feat: add SQLite schema`
- `feat: add document import (pdf/docx)`
- `feat: implement FTS search`
- `feat: add pdf viewer with page jump`
- `feat: add copy citation`
